"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[92984],{15680:(e,t,n)=>{n.d(t,{xA:()=>s,yg:()=>m});var a=n(96540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},p=Object.keys(e);for(a=0;a<p.length;a++)n=p[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(a=0;a<p.length;a++)n=p[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),c=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},y=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,p=e.originalType,i=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),d=c(n),y=r,m=d["".concat(i,".").concat(y)]||d[y]||u[y]||p;return n?a.createElement(m,l(l({ref:t},s),{},{components:n})):a.createElement(m,l({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var p=n.length,l=new Array(p);l[0]=y;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o[d]="string"==typeof e?e:r,l[1]=o;for(var c=2;c<p;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}y.displayName="MDXCreateElement"},31187:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>v,contentTitle:()=>g,default:()=>N,frontMatter:()=>m,metadata:()=>f,toc:()=>b});var a=n(15680),r=Object.defineProperty,p=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,s=(e,t,n)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d=(e,t)=>{for(var n in t||(t={}))i.call(t,n)&&s(e,n,t[n]);if(o)for(var n of o(t))c.call(t,n)&&s(e,n,t[n]);return e},u=(e,t)=>p(e,l(t)),y=(e,t)=>{var n={};for(var a in e)i.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&o)for(var a of o(e))t.indexOf(a)<0&&c.call(e,a)&&(n[a]=e[a]);return n};const m={},g="decapsulate",f={unversionedId:"tql2/functions/decapsulate",id:"tql2/functions/decapsulate",title:"decapsulate",description:"Decapsulates packet data at link, network, and transport layer.",source:"@site/docs/tql2/functions/decapsulate.md",sourceDirName:"tql2/functions",slug:"/tql2/functions/decapsulate",permalink:"/next/tql2/functions/decapsulate",draft:!1,editUrl:"https://github.com/tenzir/tenzir/tree/main/web/docs/tql2/functions/decapsulate.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"community_id",permalink:"/next/tql2/functions/community_id"},next:{title:"encrypt_cryptopan",permalink:"/next/tql2/functions/encrypt_cryptopan"}},v={},b=[{value:"Description",id:"description",level:2},{value:"VLAN Tags",id:"vlan-tags",level:3},{value:"Examples",id:"examples",level:2}],h={toc:b},O="wrapper";function N(e){var t=e,{components:n}=t,r=y(t,["components"]);return(0,a.yg)(O,u(d(d({},h),r),{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",d({},{id:"decapsulate"}),"decapsulate"),(0,a.yg)("p",null,"Decapsulates packet data at link, network, and transport layer."),(0,a.yg)("figure",d({},{"data-rehype-pretty-code-figure":""}),(0,a.yg)("pre",d({parentName:"figure"},{tabIndex:0,"data-language":"tql","data-theme":"github-dark-default"}),(0,a.yg)("code",d({parentName:"pre"},{"data-language":"tql","data-theme":"github-dark-default",style:{display:"grid"}}),(0,a.yg)("span",d({parentName:"code"},{"data-line":""}),(0,a.yg)("span",d({parentName:"span"},{style:{color:"#D2A8FF"}}),"decapsulate"),(0,a.yg)("span",d({parentName:"span"},{style:{color:"#E6EDF3"}}),"(packet"),(0,a.yg)("span",d({parentName:"span"},{style:{color:"#FF7B72"}}),":"),(0,a.yg)("span",d({parentName:"span"},{style:{color:"#E6EDF3"}}),"field)"))))),(0,a.yg)("h2",d({},{id:"description"}),"Description"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"decapsulate")," function proceses events consisting of packet data and\ndecapsulates the payload by extracting fields at the link, network, and\ntransport layer. The aim is not completeness, but rather exposing commonly used\nfield for analytics."),(0,a.yg)("p",null,"Emits events of schema ",(0,a.yg)("inlineCode",{parentName:"p"},"tenzir.packet"),"."),(0,a.yg)("h3",d({},{id:"vlan-tags"}),"VLAN Tags"),(0,a.yg)("p",null,"While decapsulating packets, ",(0,a.yg)("inlineCode",{parentName:"p"},"decapsulate")," extracts\n",(0,a.yg)("a",d({parentName:"p"},{href:"https://en.wikipedia.org/wiki/IEEE_802.1Q"}),"802.1Q")," VLAN tags into the nested\n",(0,a.yg)("inlineCode",{parentName:"p"},"vlan")," record, consisting of an ",(0,a.yg)("inlineCode",{parentName:"p"},"outer")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"inner")," field for the respective\ntags. The value of the VLAN tag corresponds to the 12-bit VLAN identifier (VID).\nSpecial values include ",(0,a.yg)("inlineCode",{parentName:"p"},"0")," (frame does not carry a VLAN ID) and ",(0,a.yg)("inlineCode",{parentName:"p"},"0xFFF"),"\n(reserved value; sometimes wildcard match)."),(0,a.yg)("h2",d({},{id:"examples"}),"Examples"),(0,a.yg)("p",null,"Decapsulate packets from a PCAP file:"),(0,a.yg)("p",null,"XXX: Fix examples"),(0,a.yg)("pre",null,(0,a.yg)("code",d({parentName:"pre"},{}),"from file /tmp/trace.pcap read pcap\n| packet = decapsulate(this)\n")),(0,a.yg)("p",null,"Extract packets as JSON that have the address 6.6.6.6 as source or destination,\nand destination port 5158:"),(0,a.yg)("pre",null,(0,a.yg)("code",d({parentName:"pre"},{}),"read pcap\n| decapsulate\n| where 6.6.6.6 && dport == 5158\n| write json\n")),(0,a.yg)("p",null,"Query VLAN IDs using ",(0,a.yg)("inlineCode",{parentName:"p"},"vlan.outer")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"vlan.inner"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",d({parentName:"pre"},{}),"read pcap\n| decapsulate\n| where vlan.outer > 0 || vlan.inner in [1, 2, 3]\n")),(0,a.yg)("p",null,"Filter packets by ",(0,a.yg)("a",d({parentName:"p"},{href:"https://github.com/corelight/community-id-spec"}),"Community\nID"),":"),(0,a.yg)("pre",null,(0,a.yg)("code",d({parentName:"pre"},{}),'read pcap\n| decapsulate\n| where community_id == "1:wCb3OG7yAFWelaUydu0D+125CLM="\n')))}N.isMDXComponent=!0}}]);