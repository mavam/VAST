"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[44744],{15680:(e,n,t)=>{t.d(n,{xA:()=>u,yg:()=>m});var a=t(96540);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(t),g=i,m=c["".concat(s,".").concat(g)]||c[g]||d[g]||r;return t?a.createElement(m,o(o({ref:n},u),{},{components:t})):a.createElement(m,o({ref:n},u))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=g;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[c]="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},28788:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>y,contentTitle:()=>h,default:()=>k,frontMatter:()=>m,metadata:()=>f,toc:()=>v});var a=t(15680),i=Object.defineProperty,r=Object.defineProperties,o=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,u=(e,n,t)=>n in e?i(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,c=(e,n)=>{for(var t in n||(n={}))s.call(n,t)&&u(e,t,n[t]);if(l)for(var t of l(n))p.call(n,t)&&u(e,t,n[t]);return e},d=(e,n)=>r(e,o(n)),g=(e,n)=>{var t={};for(var a in e)s.call(e,a)&&n.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&l)for(var a of l(e))n.indexOf(a)<0&&p.call(e,a)&&(t[a]=e[a]);return t};const m={},h="Packages",f={unversionedId:"packages",id:"version-v4.21/packages",title:"Packages",description:"A package is a set of pipelines and contexts that are thematically related",source:"@site/versioned_docs/version-v4.21/packages.md",sourceDirName:".",slug:"/packages",permalink:"/packages",draft:!1,editUrl:"https://github.com/tenzir/tenzir/tree/main/web/versioned_docs/version-v4.21/packages.md",tags:[],version:"v4.21",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Pipelines",permalink:"/pipelines"},next:{title:"Why Tenzir",permalink:"/why-tenzir"}},y={},v=[{value:"Anatomy of a Package",id:"anatomy-of-a-package",level:2},{value:"Metadata",id:"metadata",level:3},{value:"Inputs",id:"inputs",level:3},{value:"Pipelines and Contexts",id:"pipelines-and-contexts",level:3},{value:"Examples",id:"examples",level:3},{value:"Configuration During Installation",id:"configuration-during-installation",level:2},{value:"Inputs",id:"inputs-1",level:3},{value:"Overrides",id:"overrides",level:3}],b={toc:v},x="wrapper";function k(e){var n=e,{components:t}=n,i=g(n,["components"]);return(0,a.yg)(x,d(c(c({},b),i),{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",c({},{id:"packages"}),"Packages"),(0,a.yg)("p",null,"A ",(0,a.yg)("strong",{parentName:"p"},"package")," is a set of pipelines and contexts that are thematically related\nand deployed together as a single unit."),(0,a.yg)("admonition",c({},{title:"Use packages",type:"tip"}),(0,a.yg)("p",{parentName:"admonition"},"Start using packages by ",(0,a.yg)("a",c({parentName:"p"},{href:"/installation/install-a-package"}),"installing one"),".")),(0,a.yg)("h2",c({},{id:"anatomy-of-a-package"}),"Anatomy of a Package"),(0,a.yg)("p",null,"A package definition consists of four major parts:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Metadata"),", for example the name, author and description of the\npackage."),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Inputs")," that parameterize the package installation to their environment."),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Pipelines and contexts")," that make up the contents of the package."),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("strong",{parentName:"li"},"Examples")," that demonstrate how to use the package.")),(0,a.yg)("h3",c({},{id:"metadata"}),"Metadata"),(0,a.yg)("p",null,"Packages start with a set of metadata describing the package."),(0,a.yg)("pre",null,(0,a.yg)("code",c({parentName:"pre"},{className:"language-yaml"}),"# The unique ID of the package. (required)\nid: example\n\n# The display name of the package and a path to an icon for the package.\nname: Example\npackage_icon: https://github.com/tenzir.png\n\n# The display name of the package author and a path to a profile picture.\nauthor: Tenzir\nauthor_icon: https://github.com/tenzir.png\n\n# A user-facing description of the package.\ndescription: |\n  **Lorem ipsum** dolor sit amet, consectetur adipiscing elit. Nullam suscipit\n  lacus felis, ac lacinia nibh pretium ut. Curabitur congue aliquam neque.\n  Vivamus in magna non turpis malesuada volutpat ut a felis. Ut lorem eros,\n  vulputate eget finibus ut, posuere sed leo. Vestibulum porta laoreet\n  venenatis. Curabitur aliquet semper sem, et tincidunt metus cursus at. Nulla\n  dapibus nibh vel faucibus commodo. Sed euismod eu sapien ut dictum. Phasellus\n  tincidunt venenatis semper.\n")),(0,a.yg)("h3",c({},{id:"inputs"}),"Inputs"),(0,a.yg)("p",null,"Inputs are template variables that get replaced upon package installation. This\nallows the package definition to be independent of the deployed environment."),(0,a.yg)("pre",null,(0,a.yg)("code",c({parentName:"pre"},{className:"language-yaml"}),"# Define user inputs to customize the package installation.\ninputs:\n  # Every input must have a unique id.\n  refresh-rate:\n    # A user-facing name for the input (required).\n    name: Refresh Rate\n    # A user-facing description of the input.\n    description: |\n      The interval at which we refresh our example context.\n      Defaults to refreshing every second.\n    # An (optional) default value for the input. The input is required if there\n    # is no input value.\n    default: 1s\n")),(0,a.yg)("p",null,"Inputs can be referenced in pipeline and example definitions and in context\narguments with the syntax ",(0,a.yg)("inlineCode",{parentName:"p"},"{{ inputs.input-name }}"),". They are replaced by their\nconfigured values when installing a package. For example, with the input\nconfigured as above the pipeline ",(0,a.yg)("inlineCode",{parentName:"p"},"every {{ inputs.refresh-rate }} { version }"),"\nwould print the version once per second by default."),(0,a.yg)("p",null,"To write double curly braces, use the syntax ",(0,a.yg)("inlineCode",{parentName:"p"},"{{ '{{' }}")," to produce the\nliteral string enclosed inside the single quotes."),(0,a.yg)("h3",c({},{id:"pipelines-and-contexts"}),"Pipelines and Contexts"),(0,a.yg)("p",null,"A package is a unit of pipelines and contexts that is deployed together. The\n",(0,a.yg)("inlineCode",{parentName:"p"},"pipelines")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"contexts")," fields define them:"),(0,a.yg)("pre",null,(0,a.yg)("code",c({parentName:"pre"},{className:"language-yaml"}),"# Define any number of pipelines.\npipelines:\n  update-context:\n    # An optional user-facing name for the pipeline. Defaults to the id.\n    name: Update Example Context\n    # An optional user-facing description of the pipeline.\n    description: |\n      Periodically refresh the Example lookup table.\n    # The definition of the pipeline. Configured pipelines that fail to start\n    # cause the node to fail to start.\n    definition: |\n      every ${{ inputs.refresh-rate }}\n        from https://example.org/\n          read csv --allow-comments\n      | context update example --key foo\n    # Pipelines that encounter an error stop running and show an error state.\n    # This option causes pipelines to automatically restart when they\n    # encounter an error instead. The first restart happens immediately, and\n    # subsequent restarts after the configured delay, defaulting to 1 minute.\n    # The following values are valid for this option:\n    # - Omit the option, or set it to null or false to disable.\n    # - Set the option to true to enable with the default delay of 1 minute.\n    # - Set the option to a valid duration to enable with a custom delay.\n    restart-on-error: 1 minute\n    # Disables the pipeline.\n    disabled: false\n    # Unstoppable pipelines will run automatically and indefinitely.\n    # They cannot be paused or stopped manually.\n    # If they do complete, they will end up in a failed state.\n    # If `restart-on-error` is enabled, they will restart after the specified\n    # duration.\n    unstoppable: true\n\n# Define any number of contexts.\ncontexts:\n  # A unique name for the context that's used in the context, enrich, and\n  # lookup operators to refer to the context.\n  example:\n    # The type of the context (required).\n    type: lookup-table\n    # An optional user-facing description of the context.\n    description: |\n      **Lorem ipsum** dolor sit amet, consectetur adipiscing elit. Nullam\n      suscipit lacus felis, ac lacinia nibh pretium ut. Curabitur congue aliquam\n      neque. Vivamus in magna non turpis malesuada volutpat ut a felis. Ut lorem\n      eros, vulputate eget finibus ut, posuere sed leo. Vestibulum porta laoreet\n      venenatis. Curabitur aliquet semper sem, et tincidunt metus cursus at.\n      Nulla dapibus nibh vel faucibus commodo. Sed euismod eu sapien ut dictum.\n      Phasellus tincidunt venenatis semper.\n      \n    # Arguments for creating the context, depending on the type. Refer to the\n    # documentation of the individual context types to see the arguments they\n    # require. Note that changes to these arguments do not apply to any\n    # contexts that were previously created.\n    args: {}\n    # Disables the context.\n    disabled: false\n")),(0,a.yg)("h3",c({},{id:"examples"}),"Examples"),(0,a.yg)("p",null,"Packages may include examples that showcase how to use the package, e.g., by\nshowing how to display a chart that visualizes data imported by a package, or by\nproviding a set of usage examples for data provided by a package."),(0,a.yg)("pre",null,(0,a.yg)("code",c({parentName:"pre"},{className:"language-yaml"}),'# Examples contain a name, a description, and a pipeline definition for use with\n# the explorer on app.tenzir.com.\nexamples:\n  - name: Show example context details\n    description: |\n      This pipelines shows the contents of the example lookup table.\n    definition: |\n      context inspect example\n  - name: |\n      Visualize successful lookups with the `example` context in the last week\n    description: |\n      Creates a stacked area chart that shows the number of hourly hits of\n      pipelines using the `lookup` operator with the `example` context.\n    definition: |\n      metrics lookup\n      | where context == "example"\n      | where timestamp > 7d ago\n      | summarize retro_hits=sum(retro.hits), live_hits=sum(live.hits)\n          by timestamp\n          resolution 1h\n      | sort timestamp\n      | chart area --position stacked\n')),(0,a.yg)("h2",c({},{id:"configuration-during-installation"}),"Configuration During Installation"),(0,a.yg)("p",null,"During installation, the package definition gets merged with a\nconfiguration object. This can happen in three ways:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"In the ",(0,a.yg)("a",c({parentName:"li"},{href:"https://app.tenzir.com/library"}),"Tenzir Library"),", you provide inputs\nthat get converted into a ",(0,a.yg)("inlineCode",{parentName:"li"},"config")," object."),(0,a.yg)("li",{parentName:"ol"},"Using the ",(0,a.yg)("a",c({parentName:"li"},{href:"/operators/package"}),(0,a.yg)("inlineCode",{parentName:"a"},"package_add"))," operator, you construct a\n",(0,a.yg)("inlineCode",{parentName:"li"},"config")," record explicitly."),(0,a.yg)("li",{parentName:"ol"},"Using IaC-style installation, you provide a ",(0,a.yg)("inlineCode",{parentName:"li"},"config.yaml")," with a ",(0,a.yg)("inlineCode",{parentName:"li"},"config"),"\nkey.")),(0,a.yg)("p",null,"Refer to the ",(0,a.yg)("a",c({parentName:"p"},{href:"/installation/install-a-package"}),"package installation guide")," for\ndetails on how each method works."),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"config")," record has the following structure:"),(0,a.yg)("pre",null,(0,a.yg)("code",c({parentName:"pre"},{className:"language-yaml"}),'config:\n  # An optional string to identify the package version being installed.\n  version: "4.0"\n  # An unambigous description of the upstream source of this package.\n  source:\n    repository: https://github.com/tenzir/library\n    directory: example/\n    revision: 1274bd6042e4b74d07363643b5b01811e191b74c\n  # A dictionary mapping input fields to their desired values.\n  inputs:\n    filename: /opt/example/data.tsv\n  # A set of keys that override the corresponding fields in the package\n  # definition.\n  overrides:\n    pipelines:\n      example-pipeline:\n        disabled: true\n  # Opaque extra data that is ignored by the node.\n  metadata:\n    ansible:\n      deployment_id: 483dej2\n')),(0,a.yg)("h3",c({},{id:"inputs-1"}),"Inputs"),(0,a.yg)("p",null,"Pipeline and context definitions may contain references to template variables,\nas in ",(0,a.yg)("inlineCode",{parentName:"p"},"from {{ inputs.filename }} version"),", that are replaced by their\nconfigured value when installing the package."),(0,a.yg)("p",null,"In order to provide non-default values for the defined inputs, use the\n",(0,a.yg)("inlineCode",{parentName:"p"},"config.inputs")," key:"),(0,a.yg)("pre",null,(0,a.yg)("code",c({parentName:"pre"},{className:"language-yaml"}),"config:\n  inputs:\n    filename: /opt/example/data.tsv\n")),(0,a.yg)("h3",c({},{id:"overrides"}),"Overrides"),(0,a.yg)("p",null,"The ",(0,a.yg)("inlineCode",{parentName:"p"},"config.overrides")," object is used to change the value of any field in the\npackage definition. This is intended to customize fields like ",(0,a.yg)("inlineCode",{parentName:"p"},"disabled")," or\n",(0,a.yg)("inlineCode",{parentName:"p"},"restart-on-error")," in pipeline definitions:"),(0,a.yg)("pre",null,(0,a.yg)("code",c({parentName:"pre"},{className:"language-yaml"}),"config:\n  overrides:\n    pipelines:\n      example-pipeline:\n        disabled: true\n")))}k.isMDXComponent=!0}}]);