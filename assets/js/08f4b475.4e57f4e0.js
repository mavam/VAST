"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[81551],{15680:(e,t,a)=>{a.d(t,{xA:()=>c,yg:()=>g});var r=a(96540);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var p=r.createContext({}),l=function(e){var t=r.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},c=function(e){var t=l(e.components);return r.createElement(p.Provider,{value:t},e.children)},m="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=l(a),u=n,g=m["".concat(p,".").concat(u)]||m[u]||y[u]||o;return a?r.createElement(g,s(s({ref:t},c),{},{components:a})):r.createElement(g,s({ref:t},c))}));function g(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,s=new Array(o);s[0]=u;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[m]="string"==typeof e?e:n,s[1]=i;for(var l=2;l<o;l++)s[l]=a[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}u.displayName="MDXCreateElement"},11980:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>h,contentTitle:()=>d,default:()=>F,frontMatter:()=>g,metadata:()=>f,toc:()=>b});var r=a(15680),n=Object.defineProperty,o=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,c=(e,t,a)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,m=(e,t)=>{for(var a in t||(t={}))p.call(t,a)&&c(e,a,t[a]);if(i)for(var a of i(t))l.call(t,a)&&c(e,a,t[a]);return e},y=(e,t)=>o(e,s(t)),u=(e,t)=>{var a={};for(var r in e)p.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&i)for(var r of i(e))t.indexOf(r)<0&&l.call(e,r)&&(a[r]=e[r]);return a};const g={sidebar_position:6},d="Collect metrics",f={unversionedId:"usage/collect-metrics",id:"version-v4.24/usage/collect-metrics",title:"Collect metrics",description:"Tenzir keeps track of metrics about node resource usage, pipeline state, and",source:"@site/versioned_docs/version-v4.24/usage/collect-metrics.md",sourceDirName:"usage",slug:"/usage/collect-metrics",permalink:"/usage/collect-metrics",draft:!1,editUrl:"https://github.com/tenzir/tenzir/tree/main/web/versioned_docs/version-v4.24/usage/collect-metrics.md",tags:[],version:"v4.24",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"docsSidebar",previous:{title:"Show available schemas",permalink:"/usage/show-available-schemas"},next:{title:"Transform data at rest",permalink:"/usage/transform-data-at-rest"}},h={},b=[{value:"Write metrics to a file",id:"write-metrics-to-a-file",level:2},{value:"Summarize metrics",id:"summarize-metrics",level:2}],v={toc:b},N="wrapper";function F(e){var t=e,{components:a}=t,n=u(t,["components"]);return(0,r.yg)(N,y(m(m({},v),n),{components:a,mdxType:"MDXLayout"}),(0,r.yg)("h1",m({},{id:"collect-metrics"}),"Collect metrics"),(0,r.yg)("p",null,"Tenzir keeps track of metrics about node resource usage, pipeline state, and\nruntime performance."),(0,r.yg)("p",null,"Metrics are stored as internal events in the node's storage engine, allowing you\nto work with metrics just like regular data. Use the\n",(0,r.yg)("a",m({parentName:"p"},{href:"/tql2/operators/metrics"}),(0,r.yg)("inlineCode",{parentName:"a"},"metrics"))," source operator to access the metrics.\nThe operator documentation lists ",(0,r.yg)("a",m({parentName:"p"},{href:"../tql2/operators/metrics#schemas"}),"all available\nmetrics")," in detail."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"metrics")," operator provides a ",(0,r.yg)("em",{parentName:"p"},"copy")," of existing metrics. You can use it\nmultiple time to reference the same metrics feed."),(0,r.yg)("h2",m({},{id:"write-metrics-to-a-file"}),"Write metrics to a file"),(0,r.yg)("p",null,"Export metrics continuously to a file via ",(0,r.yg)("inlineCode",{parentName:"p"},"metrics --live"),":"),(0,r.yg)("figure",m({},{"data-rehype-pretty-code-figure":""}),(0,r.yg)("pre",m({parentName:"figure"},{tabIndex:0,"data-language":"tql","data-theme":"github-dark-default"}),(0,r.yg)("code",m({parentName:"pre"},{"data-language":"tql","data-theme":"github-dark-default",style:{display:"grid"}}),(0,r.yg)("span",m({parentName:"code"},{"data-line":""}),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#D2A8FF"}}),"metrics"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#E6EDF3"}})," live"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#FF7B72"}}),"="),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#79C0FF"}}),"true")),"\n",(0,r.yg)("span",m({parentName:"code"},{"data-line":""}),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#D2A8FF"}}),"write_ndjson")),"\n",(0,r.yg)("span",m({parentName:"code"},{"data-line":""}),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#D2A8FF"}}),"save_file"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#A5D6FF"}}),' "metrics.json"'),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#E6EDF3"}}),", append"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#FF7B72"}}),"="),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#79C0FF"}}),"true"))))),(0,r.yg)("p",null,"This attaches to incoming metrics feed, renders them as NDJSON, and then writes\nthe output to a file. Without the ",(0,r.yg)("inlineCode",{parentName:"p"},"live")," option, the ",(0,r.yg)("inlineCode",{parentName:"p"},"metrics")," operator returns\nthe snapshot of all historical metrics."),(0,r.yg)("h2",m({},{id:"summarize-metrics"}),"Summarize metrics"),(0,r.yg)("p",null,"You can ",(0,r.yg)("a",m({parentName:"p"},{href:"/usage/shape-data/"}),"shape")," metrics like ordinary data,\ne.g., write aggregations over metrics to compute runtime statistics suitable for\nreporting or dashboarding:"),(0,r.yg)("figure",m({},{"data-rehype-pretty-code-figure":""}),(0,r.yg)("pre",m({parentName:"figure"},{tabIndex:0,"data-language":"tql","data-theme":"github-dark-default"}),(0,r.yg)("code",m({parentName:"pre"},{"data-language":"tql","data-theme":"github-dark-default",style:{display:"grid"}}),(0,r.yg)("span",m({parentName:"code"},{"data-line":""}),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#D2A8FF"}}),"metrics")),"\n",(0,r.yg)("span",m({parentName:"code"},{"data-line":""}),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#D2A8FF"}}),"where"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#FF7B72"}})," @"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#E6EDF3"}}),"name "),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#FF7B72"}}),"=="),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#A5D6FF"}}),' "tenzir.metrics.operator"'),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#FF7B72"}})," and"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#E6EDF3"}})," sink "),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#FF7B72"}}),"=="),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#79C0FF"}})," true")),"\n",(0,r.yg)("span",m({parentName:"code"},{"data-line":""}),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#D2A8FF"}}),"summarize"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#E6EDF3"}})," runtime"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#FF7B72"}}),"="),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#D2A8FF"}}),"sum"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#E6EDF3"}}),"(duration), pipeline_id")),"\n",(0,r.yg)("span",m({parentName:"code"},{"data-line":""}),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#D2A8FF"}}),"sort"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#FF7B72"}})," -"),(0,r.yg)("span",m({parentName:"span"},{style:{color:"#E6EDF3"}}),"runtime"))))),(0,r.yg)("p",null,"The above example computes the total runtime over all pipelines grouped by their\nunique ID."))}F.isMDXComponent=!0}}]);